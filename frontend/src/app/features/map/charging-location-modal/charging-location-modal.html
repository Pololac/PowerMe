@if (location()) {
  <div class="relative bg-neutral-grey4 rounded-xl overflow-hidden">
    <!-- Bouton fermer -->
    <button
      type="button"
      class="absolute top-3 right-3 z-10 w-6 h-6 p-1 rounded-full bg-neutral-grey2 text-neutral-grey5 opacity-80 flex items-center justify-center hover:opacity-100 transition"
      (click)="close()"
      aria-label="Fermer"
    >
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path
          fill-rule="evenodd"
          clip-rule="evenodd"
          d="M5.29289 5.29289C5.68342 4.90237 6.31658 4.90237 6.70711 5.29289L12 10.5858L17.2929 5.29289C17.6834 4.90237 18.3166 4.90237 18.7071 5.29289C19.0976 5.68342 19.0976 6.31658 18.7071 6.70711L13.4142 12L18.7071 17.2929C19.0976 17.6834 19.0976 18.3166 18.7071 18.7071C18.3166 19.0976 17.6834 19.0976 17.2929 18.7071L12 13.4142L6.70711 18.7071C6.31658 19.0976 5.68342 19.0976 5.29289 18.7071C4.90237 18.3166 4.90237 17.6834 5.29289 17.2929L10.5858 12L5.29289 6.70711C4.90237 6.31658 4.90237 5.68342 5.29289 5.29289Z"
          fill="currentColor"
        />
      </svg>
    </button>

    @if (loading()) {
      <div class="p-4">
        <p>Chargement…</p>
      </div>
    } @else {
      <!-- Image location (sans bord) -->
      <img
        [src]="location()?.imagePath ?? 'assets/images/location-desktop.webp'"
        alt="Lieu de recharge"
        class="w-full h-44 object-cover"
        (error)="onImageError($event)"
      />

      <!-- Infos location -->
      <div class="p-4 space-y-1 bg-white">
        <h4>
          {{ location()!.name }}
        </h4>

        <p class="subtitle2 text-neutral-grey2">
          {{ location()!.address }}
        </p>
      </div>

      <!-- Liste des bornes -->
      <div class="p-3 space-y-3">
        @for (station of location()!.stations; track station.id) {
          <button
            type="button"
            class="group w-full flex items-center bg-neutral-100 rounded-lg text-left hover:scale-[1.03] transition"
            [class.ring-3]="isSelected(station)"
            [class.ring-mint-500]="isSelected(station)"
            (click)="openStation(station)"
            aria-label="Voir le détail de la borne"
          >
            <div
              class="relative w-full flex items-center justify-between bg-white rounded-lg px-3 py-3"
            >
              <!-- Liseré gauche selon statut -->
              <span
                class="absolute left-0 top-0 h-full w-2 rounded-l-lg"
                [ngClass]="STATION_STATUS_UI[station.status].borderClass"
              ></span>

              <!-- Contenu borne -->
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3 pl-2">
                  <app-icon [name]="SOCKET_TYPE_ICON[station.socketType]" size="lg" />

                  <div>
                    <div class="subtitle1">{{ station.powerKw }} kW</div>
                    <div class="subtitle2 text-neutral-grey2">
                      {{ SOCKET_TYPE_LABEL[station.socketType] }}
                    </div>
                  </div>
                </div>
              </div>

              <!-- Statut + chevron -->
              <div class="flex text-right items-center">
                <!-- Statut -->
                <span class="subtitle2" [ngClass]="STATION_STATUS_UI[station.status].textClass">
                  {{ STATION_STATUS_UI[station.status].label }}
                </span>

                <!-- Chevron -->
                <svg
                  class="w-10 h-10 text-neutral-grey3 group-hover:text-neutral-grey2 transition"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  aria-hidden="true"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path d="M9.5 7L14.5 12L9.5 17" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
              </div>
            </div>
          </button>
        }
      </div>
    }
  </div>
}
