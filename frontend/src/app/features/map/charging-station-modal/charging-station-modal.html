@if (station()) {
  <div class="relative bg-neutral-grey4 rounded-xl">
    @if (loading()) {
      <div class="p-4">
        <p>Chargement…</p>
      </div>
    } @else {
      <div class="p-3 space-y-3">
        <!-- Infos borne -->
        <div class="relative px-4 py-3 bg-white rounded-lg">
            <div class="text-center">
              <h4>{{ station()!.name }}</h4>
            </div>
          <button
            type="button"
            class="absolute top-3 right-3 z-10 w-6 h-6 p-1 rounded-full bg-neutral-grey4 text-white opacity-80 flex items-center justify-center hover:opacity-100 transition"
            (click)="close()"
            aria-label="Fermer"
          >
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M5.29289 5.29289C5.68342 4.90237 6.31658 4.90237 6.70711 5.29289L12 10.5858L17.2929 5.29289C17.6834 4.90237 18.3166 4.90237 18.7071 5.29289C19.0976 5.68342 19.0976 6.31658 18.7071 6.70711L13.4142 12L18.7071 17.2929C19.0976 17.6834 19.0976 18.3166 18.7071 18.7071C18.3166 19.0976 17.6834 19.0976 17.2929 18.7071L12 13.4142L6.70711 18.7071C6.31658 19.0976 5.68342 19.0976 5.29289 18.7071C4.90237 18.3166 4.90237 17.6834 5.29289 17.2929L10.5858 12L5.29289 6.70711C4.90237 6.31658 4.90237 5.68342 5.29289 5.29289Z"
                fill="currentColor"
              />
            </svg>
          </button>

        </div>
        <!-- Tarifs -->
        <div class="relative px-4 py-3 bg-white rounded-lg flex flex-col items-center gap">
          <h4 class="self-start">Tarifs</h4>
          <p class="text-body1-size font-semibold">{{ station()!.hourlyRate }} € / heure de charge</p>
        </div>


        <div class="relative px-4 py-3 bg-white rounded-lg">
          <div class="flex gap-3 items-center">
            <h4>Disponibilités</h4>
            <div class="text-sm text-gray-500 mt-2">
              Sélectionnez une date pour voir les disponibilités.
            </div>
          </div>
          <div class="grid grid-cols-[400px_1fr]">
            <!-- Calendrier -->
            <app-availability-calendar
              (dateSelected)="onDateSelected($event)"
            />

            <!-- Slots -->
            @if (stationStore.availabilityLoading()) {
              <div class="flex items-center justify-center text-sm text-gray-500">
                Chargement des créneaux…
              </div>
            }

            @else if (stationStore.availability()) {
              <app-availability-slots
                [slots]="stationStore.visibleSlots()"
                [selectedSlots]="stationStore.selectedSlots()"
                (slotClicked)="stationStore.selectSlot($event)"
              />
            }
          </div>

          <!-- Footer -->
          @if (stationStore.canBook()) {
            <div class="flex justify-center mt-2">
              <button
                class="pm-btn pm-btn--secondary pm-btn--secondary:hover px-4 py-2"
                (click)="confirmReservation()"
              >
                Suivant
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <path d="M13 7L18 12M13 17L18 12M18 12H6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
          }
        </div>

      </div>
    }
  </div>
}
