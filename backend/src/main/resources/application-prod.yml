# ==============================================
# Configuration PRODUCTION
# ==============================================
# ⚠️ Toutes les variables sont OBLIGATOIRES (depuis .env)
# ⚠️ Pas de valeurs par défaut

spring:
  # ====== JPA / HIBERNATE ======
  jpa:
    hibernate:
      ddl-auto: validate # Ne modifie PAS le schéma (sécurité)
    show-sql: false
    properties:
      hibernate:
        format_sql: false
        dialect: org.hibernate.spatial.dialect.postgis.PostgisPG95Dialect

  # ====== FLYWAY : SVG migrations ======
  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration
    schemas: public
    validate-on-migrate: true

  # ====== EMAIL SMTP ======
  mail:
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
            required: true
          connectiontimeout: 10000
          timeout: 10000

# ====== SERVEUR ======
server:
  port: ${SERVER_PORT:8081}
  compression:
    enabled: true
    mime-types: text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json
    min-response-size: 1024
  error:
    include-stacktrace: never
    include-message: always

# ====== LOGGING MINIMAL ======
logging: # Seulement INFO et plus grave
  level:
    root: WARN
    com.powerme.backend: INFO
    org.springframework.web: WARN
    org.springframework.security: WARN
    org.hibernate: WARN

  # Logs sauvegardés en fichiers
  file:
    name: /var/log/powerme/application.log

  logback:
    rolling policy:
      max-file-size: 50MB                    # Taille max d'un fichier
      max-history: 30                        # Nombre de fichiers à garder
      total-size-cap: 1GB                    # Taille totale max
      file-name-pattern: ${LOG_FILE}.%d{yyyy-MM-dd}.%i.gz  # Pattern de rotation

# ====== MODE DEBUG DÉSACTIVÉ ======
app:
  debug: false  # Messages d'erreur génériques (sécurité)
  frontend-url: https://powerme-app.placoste.dev

